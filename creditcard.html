<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Card Payment - Paying Guest</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-color: #3B82F6;
            --primary-light: #60A5FA;
            --primary-dark: #2563EB;
            --secondary-color: #F472B6;
            --accent-color: #10B981;
            --text-color: #1F2937;
            --text-light: #6B7280;
            --background-color: #F3F4F6;
            --card-bg: #FFFFFF;
            --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            --hover-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
            --border-radius: 12px;
            --input-bg: #F9FAFB;
            --input-border: #E5E7EB;
            --input-focus: #3B82F6;
            --success-color: #10B981;
            --error-color: #EF4444;
            --warning-color: #F59E0B;
            --info-color: #3B82F6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #EFF6FF, #F1F5F9);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            line-height: 1.5;
        }
        
        .container {
            max-width: 480px;
            width: 100%;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            overflow: hidden;
            transition: all 0.3s ease;
            animation: slideUp 0.6s ease-out;
            position: relative;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .container:hover {
            transform: translateY(-3px);
            box-shadow: var(--hover-shadow);
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 25px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 6px;
            position: relative;
            letter-spacing: -0.01em;
        }
        
        .header p {
            font-size: 15px;
            opacity: 0.9;
            font-weight: 400;
        }
        
        .card-icon {
            font-size: 36px;
            margin-bottom: 12px;
            animation: float 3s ease-in-out infinite;
            color: rgba(255, 255, 255, 0.9);
            background: rgba(255, 255, 255, 0.15);
            width: 70px;
            height: 70px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        @keyframes float {
            0% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
            100% {
                transform: translateY(0px);
            }
        }
        
        .form-container {
            padding: 30px;
        }
        
        .form-group {
            margin-bottom: 22px;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-color);
            font-weight: 500;
            font-size: 14px;
            letter-spacing: -0.01em;
        }
        
        input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--input-border);
            background-color: var(--input-bg);
            border-radius: 8px;
            font-size: 15px;
            color: var(--text-color);
            font-family: 'Inter', sans-serif;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        }
        
        input:hover {
            border-color: #CBD5E1;
        }
        
        input:focus {
            outline: none;
            border-color: var(--input-focus);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }
        
        input::placeholder {
            color: #94A3B8;
        }
        
        .input-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }
        
        .card-number-container {
            position: relative;
        }
        
        .card-type {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .expiry-cvv-container {
            display: flex;
            gap: 20px;
        }
        
        .expiry-container, .cvv-container {
            flex: 1;
        }
        
        .btn {
            width: 100%;
            padding: 12px 16px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.65;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        .btn i {
            font-size: 14px;
        }
        
        .back-btn {
            background: white;
            color: var(--text-color);
            border: 1px solid var(--input-border);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        
        .back-btn:hover {
            background: var(--background-color);
            color: var(--primary-color);
            border-color: #CBD5E1;
        }
        
        .back-btn:focus {
            box-shadow: 0 0 0 3px rgba(203, 213, 225, 0.4);
        }
        
        .footer {
            padding: 20px 30px;
            background-color: var(--background-color);
            text-align: center;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .footer p {
            color: var(--text-light);
            font-size: 13px;
        }
        
        .secure-badge {
            display: inline-flex;
            align-items: center;
            background-color: rgba(16, 185, 129, 0.08);
            color: var(--success-color);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin-top: 10px;
            font-weight: 500;
        }
        
        .secure-badge i {
            margin-right: 6px;
        }
        
        .card-brands {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
            margin-bottom: 25px;
        }
        
        .card-brand {
            font-size: 24px;
            color: #94A3B8;
            transition: all 0.2s ease;
            opacity: 0.6;
        }
        
        .card-brand:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }
        
        .card-brand.active {
            color: var(--primary-color);
            opacity: 1;
        }
        
        /* Progress indicator */
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            position: relative;
        }
        
        .progress-steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 20px;
            right: 20px;
            height: 2px;
            background-color: var(--input-border);
            z-index: 1;
        }
        
        .progress-step {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }
        
        .step-indicator {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: white;
            border: 2px solid var(--input-border);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text-light);
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .step-text {
            font-size: 12px;
            color: var(--text-light);
            text-align: center;
        }
        
        .progress-step.active .step-indicator {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        
        .progress-step.active .step-text {
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .progress-step.completed .step-indicator {
            background-color: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }
        
        /* Card flip animation */
        .card-container {
            perspective: 1000px;
            margin-bottom: 30px;
            margin-top: 5px;
        }
        
        .credit-card {
            width: 100%;
            height: 200px;
            position: relative;
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-style: preserve-3d;
            cursor: pointer;
        }
        
        .credit-card.flipped {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .card-front {
            background: linear-gradient(120deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card-front::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 20%),
                linear-gradient(to right, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
            opacity: 0.6;
        }
        
        .card-back {
            background: linear-gradient(120deg, var(--primary-dark), var(--primary-color));
            color: white;
            transform: rotateY(180deg);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card-back::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 90% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 10% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 20%),
                linear-gradient(to left, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
            opacity: 0.6;
        }
        
        .card-logo {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }
        
        .card-chip {
            width: 45px;
            height: 35px;
            background: linear-gradient(135deg, #FFD700, #F59E0B);
            border-radius: 6px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .card-chip::before, .card-chip::after {
            content: '';
            position: absolute;
            background-color: rgba(0, 0, 0, 0.1);
        }
        
        .card-chip::before {
            width: 100%;
            height: 30%;
            top: 35%;
        }
        
        .card-chip::after {
            width: 30%;
            height: 100%;
            left: 35%;
        }
        
        .card-number-display {
            font-size: 20px;
            letter-spacing: 2px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            position: relative;
            z-index: 1;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-between;
        }
        
        .card-number-display span {
            display: inline-block;
        }
        
        .card-holder {
            font-size: 11px;
            text-transform: uppercase;
            margin-bottom: 4px;
            opacity: 0.8;
            letter-spacing: 0.5px;
            position: relative;
            z-index: 1;
        }
        
        .card-name {
            font-size: 16px;
            text-transform: uppercase;
            margin-bottom: 15px;
            font-weight: 500;
            position: relative;
            z-index: 1;
            letter-spacing: 0.5px;
        }
        
        .card-expiry {
            display: flex;
            font-size: 14px;
            position: relative;
            z-index: 1;
            align-items: center;
        }
        
        .card-expiry span {
            opacity: 0.8;
            margin-right: 8px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .card-stripe {
            background-color: #000;
            height: 40px;
            margin: 20px 0;
            position: relative;
            z-index: 1;
        }
        
        .card-signature {
            background-color: #fff;
            height: 35px;
            margin-top: 15px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 0 12px;
            border-radius: 4px;
            position: relative;
            z-index: 1;
        }
        
        .card-cvv {
            color: #333;
            font-weight: 600;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .amount-input {
            position: relative;
        }
        
        .amount-input input {
            padding-left: 30px;
        }
        
        .amount-input .currency-symbol {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-color);
            font-weight: 500;
            font-size: 15px;
        }
        
        .input-icon {
            color: #94A3B8;
            font-size: 14px;
        }
        
        /* Success message */
        .success-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            text-align: center;
            z-index: 10000;
            display: none;
            animation: scaleIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            max-width: 90%;
            width: 320px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .success-message h2 {
            color: var(--success-color);
            margin-bottom: 12px;
            font-size: 20px;
            font-weight: 600;
        }
        
        .success-message p {
            margin-bottom: 15px;
            color: var(--text-color);
            font-size: 14px;
            line-height: 1.5;
        }
        
        .transaction-id {
            background-color: var(--background-color);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            color: var(--text-light);
            margin-top: 15px;
            display: inline-block;
        }
        
        .success-icon {
            font-size: 50px;
            color: var(--success-color);
            margin-bottom: 20px;
            animation: bounce 1s ease infinite;
            background-color: rgba(16, 185, 129, 0.1);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes scaleIn {
            from { transform: translate(-50%, -50%) scale(0.9); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        /* Confetti animation */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            display: none;
        }
        
        .confetti {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #f00;
            opacity: 0.8;
            animation: fall linear forwards;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(720deg);
            }
        }
        
        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .container {
                width: 95%;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .form-container {
                padding: 25px;
            }
            
            .expiry-cvv-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .credit-card {
                height: 200px;
            }
            
            .card-number-display {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <script src="js/api.js"></script>
    <div class="container">
        <div class="header">
            <i class="fas fa-credit-card card-icon"></i>
            <h1>Secure Payment</h1>
            <p>Complete your transaction with confidence</p>
        </div>
        
        <div class="form-container">
            <div class="progress-steps">
                <div class="progress-step completed">
                    <div class="step-indicator">
                        <i class="fas fa-check" style="font-size: 12px;"></i>
                    </div>
                    <div class="step-text">Cart</div>
                </div>
                <div class="progress-step active">
                    <div class="step-indicator">2</div>
                    <div class="step-text">Payment</div>
                </div>
                <div class="progress-step">
                    <div class="step-indicator">3</div>
                    <div class="step-text">Confirm</div>
                </div>
            </div>
            
            <div class="card-container">
                <div class="credit-card" id="creditCard">
                    <div class="card-front">
                        <div class="card-logo">
                            <div class="card-chip"></div>
                            <div class="card-brand-logo" id="cardBrandLogo">
                                <i class="fab fa-cc-visa" style="font-size: 24px;"></i>
                            </div>
                        </div>
                        <div class="card-number-display" id="cardNumberDisplay">
                            <span>••••</span>
                            <span>••••</span>
                            <span>••••</span>
                            <span>••••</span>
                        </div>
                        <div class="card-holder">Card Holder</div>
                        <div class="card-name" id="cardNameDisplay">YOUR NAME</div>
                        <div class="card-expiry">
                            <span>Expires</span>
                            <div id="cardExpiryDisplay">MM/YY</div>
                        </div>
                    </div>
                    <div class="card-back">
                        <div class="card-stripe"></div>
                        <div class="card-signature">
                            <div class="card-cvv" id="cardCvvDisplay">***</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <form id="creditCardForm">
                <div class="card-brands">
                    <i class="fab fa-cc-visa card-brand active"></i>
                    <i class="fab fa-cc-mastercard card-brand"></i>
                    <i class="fab fa-cc-amex card-brand"></i>
                    <i class="fab fa-cc-discover card-brand"></i>
                </div>
                
                <div class="form-group">
                    <label for="cardName">Cardholder Name</label>
                    <div style="position: relative;">
                        <input type="text" id="cardName" placeholder="Enter name as on card" required>
                        <i class="fas fa-user input-icon"></i>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="cardNumber">Card Number</label>
                    <div class="card-number-container">
                        <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" required>
                        <div class="card-type" id="cardType">
                            <i class="fab fa-cc-visa"></i>
                        </div>
                    </div>
                </div>
                
                <div class="form-group expiry-cvv-container">
                    <div class="expiry-container">
                        <label for="expiryDate">Expiry Date</label>
                        <input type="text" id="expiryDate" placeholder="MM/YY" maxlength="5" required>
                    </div>
                    
                    <div class="cvv-container">
                        <label for="cvv">CVV</label>
                        <div style="position: relative;">
                            <input type="password" id="cvv" placeholder="***" maxlength="3" required>
                            <i class="fas fa-question-circle input-icon" title="3-digit security code on the back of your card"></i>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="amount">Payment Amount</label>
                    <div class="amount-input">
                        <span class="currency-symbol">₹</span>
                        <input type="number" id="amount" placeholder="Enter amount" min="1" required>
                    </div>
                </div>
                
                <div style="margin-top: 10px; margin-bottom: 20px;">
                    <label class="checkbox-container" style="display: flex; align-items: center; cursor: pointer; user-select: none;">
                        <input type="checkbox" checked style="margin-right: 10px; accent-color: var(--primary-color);">
                        <span style="font-size: 13px; color: var(--text-light);">Save card for future payments</span>
                    </label>
                </div>
                
                <div class="button-group" style="display: flex; gap: 12px; margin-top: 20px;">
                    
                       
                   
                    <button type="button" id="payBtn" class="btn">
                        Pay Now <i class="fas fa-lock" style="margin-left: 4px; font-size: 12px;"></i>
                    </button>
                </div>
            </form>
        </div>
        
        <div class="confetti-container" id="confetti"></div>
        
        <div class="success-message" id="successMessage">
            <div class="success-icon">
                <i class="fas fa-check"></i>
            </div>
            <h2>Payment Successful!</h2>
            <p>Your transaction has been processed successfully.</p>
            <div class="transaction-id">Transaction ID: <span id="transactionId"></span></div>
        </div>
        
        <div class="footer">
            <div class="secure-badge">
                <i class="fas fa-shield-alt"></i> Secure Payment
            </div>
            <p style="margin-top: 8px;">All transactions are secure and encrypted</p>
            <div style="margin-top: 10px; display: flex; justify-content: center; gap: 15px; align-items: center;">
                <img src="https://cdn-icons-png.flaticon.com/128/6124/6124998.png" alt="SSL" style="height: 20px;">
                <img src="https://cdn-icons-png.flaticon.com/128/349/349221.png" alt="PCI DSS" style="height: 20px;">
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Interactive credit card elements
            const creditCard = document.getElementById('creditCard');
            const cardNumberInput = document.getElementById('cardNumber');
            const cardNumberDisplay = document.getElementById('cardNumberDisplay');
            const cardNameInput = document.getElementById('cardName');
            const cardNameDisplay = document.getElementById('cardNameDisplay');
            const expiryDateInput = document.getElementById('expiryDate');
            const cardExpiryDisplay = document.getElementById('cardExpiryDisplay');
            const cvvInput = document.getElementById('cvv');
            const cardCvvDisplay = document.getElementById('cardCvvDisplay');
            const cardType = document.getElementById('cardType');
            const cardBrandLogo = document.getElementById('cardBrandLogo');
            const amountInput = document.getElementById('amount');
            const payBtn = document.getElementById('payBtn');
            const backBtn = document.getElementById('backBtn');
            const confettiContainer = document.getElementById('confetti');
            
            // Flip card when focusing on CVV
            cvvInput.addEventListener('focus', function() {
                creditCard.classList.add('flipped');
            });
            
            cvvInput.addEventListener('blur', function() {
                creditCard.classList.remove('flipped');
            });
            
            // Format card number with spaces and update card display
            cardNumberInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\s+/g, '');
                if (value.length > 0) {
                    value = value.match(new RegExp('.{1,4}', 'g')).join(' ');
                }
                e.target.value = value;
                
                // Update card display
                if (value) {
                    const parts = value.split(' ');
                    let displayHTML = '';
                    
                    for (let i = 0; i < 4; i++) {
                        if (parts[i]) {
                            displayHTML += `<span>${parts[i]}</span>`;
                        } else {
                            displayHTML += `<span>••••</span>`;
                        }
                    }
                    
                    cardNumberDisplay.innerHTML = displayHTML;
                } else {
                    cardNumberDisplay.innerHTML = `
                        <span>••••</span>
                        <span>••••</span>
                        <span>••••</span>
                        <span>••••</span>
                    `;
                }
                
                // Detect card type
                detectCardType(value.replace(/\s+/g, ''));
            });
            
            // Update cardholder name on card
            cardNameInput.addEventListener('input', function(e) {
                if (e.target.value) {
                    cardNameDisplay.textContent = e.target.value.toUpperCase();
                } else {
                    cardNameDisplay.textContent = 'YOUR NAME';
                }
            });
            
            // Format expiry date with slash and update card display
            expiryDateInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2, 4);
                }
                e.target.value = value;
                
                // Update card display
                if (value) {
                    cardExpiryDisplay.textContent = value;
                } else {
                    cardExpiryDisplay.textContent = 'MM/YY';
                }
            });
            
            // Update CVV on card
            cvvInput.addEventListener('input', function(e) {
                if (e.target.value) {
                    cardCvvDisplay.textContent = e.target.value;
                } else {
                    cardCvvDisplay.textContent = '***';
                }
            });
            
            // Get amount from session storage as default value
            const storedAmount = sessionStorage.getItem('paymentAmount');
            if (storedAmount) {
                amountInput.value = parseFloat(storedAmount);
            }
            
            // Handle payment button click
            payBtn.addEventListener('click', async function() {
                if (validateForm()) {
                    try {
                        // Show processing animation
                        const originalText = this.innerHTML;
                        this.innerHTML = '<div class="spinner"></div> Processing...';
                        this.disabled = true;
                        this.style.backgroundColor = '#4B5563';
                        
                        // Get card details
                        const cardNumber = cardNumberInput.value.replace(/\s/g, '');
                        const cardholderName = cardNameInput.value;
                        const expiryDate = expiryDateInput.value;
                        const cvv = cvvInput.value;
                        const amount = amountInput.value;
                        const last4 = cardNumber.substring(cardNumber.length - 4);
                        
                        // Store the amount in session storage
                        sessionStorage.setItem('paymentAmount', amount);
                        
                        // Store card last 4 digits for receipt
                        sessionStorage.setItem('receiptCardLast4', last4);
                        
                        // Store current date for receipt
                        sessionStorage.setItem('receiptDate', new Date().toLocaleDateString());
                        
                        // Get payment data from session storage or create new one
                        let paymentData = {};
                        const paymentDataStr = sessionStorage.getItem('paymentData');
                        
                        if (paymentDataStr) {
                            paymentData = JSON.parse(paymentDataStr);
                        } else {
                            // Create new payment data if not exists
                            const userId = localStorage.getItem('userId');
                            paymentData = {
                                userId: userId,
                                amount: amount,
                                paymentMethod: 'creditCard',
                                paymentDate: new Date().toISOString()
                            };
                        }
                        
                        // Add credit card specific details (never store full card number in production)
                        paymentData.cardDetails = {
                            cardholderName: cardholderName,
                            last4: last4,
                            expiryDate: expiryDate
                        };
                        
                        // Try to process payment with the backend
                        try {
                            // Load the API utility functions if not already loaded
                            if (typeof api === 'undefined') {
                                // If api.js is not loaded, load it dynamically
                                await new Promise((resolve, reject) => {
                                    const script = document.createElement('script');
                                    script.src = 'js/api.js';
                                    script.onload = resolve;
                                    script.onerror = reject;
                                    document.head.appendChild(script);
                                });
                            }
                            
                            // Check if user is authenticated
                            const token = localStorage.getItem('authToken');
                            if (token) {
                                // Process payment with the API
                                await api.makePayment(paymentData);
                            }
                        } catch (apiError) {
                            console.error('API error:', apiError);
                            // Continue with the flow even if API call fails
                        }
                        
                        // Update session storage with the latest payment data
                        sessionStorage.setItem('paymentData', JSON.stringify(paymentData));
                        
                        // Generate a random transaction ID
                        const transactionId = 'TXN' + Math.random().toString(36).substr(2, 9).toUpperCase();
                        document.getElementById('transactionId').textContent = transactionId;
                        
                        // Store transaction ID for receipt
                        sessionStorage.setItem('transactionId', transactionId);
                        
                        // Create confetti effect
                        createConfetti();
                        
                        // Show success message
                        const successMessage = document.getElementById('successMessage');
                        successMessage.style.display = 'block';
                        
                        // Redirect to success page after showing the message
                        setTimeout(() => {
                            window.location.href = 'payment_success.html';
                        }, 3000);
                    } catch (error) {
                        console.error('Payment processing error:', error);
                        alert('An error occurred while processing your payment. Please try again.');
                        
                        // Reset button state
                        this.innerHTML = 'Pay Now <i class="fas fa-arrow-right"></i>';
                        this.disabled = false;
                    }
                }
            });
            
            // Create confetti animation
            function createConfetti() {
                confettiContainer.style.display = 'block';
                
                const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', 
                               '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', 
                               '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722'];
                
                for (let i = 0; i < 150; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.width = Math.random() * 10 + 5 + 'px';
                    confetti.style.height = Math.random() * 10 + 5 + 'px';
                    confetti.style.opacity = Math.random() + 0.5;
                    confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
                    confetti.style.transform = 'rotate(' + Math.random() * 360 + 'deg)';
                    
                    confettiContainer.appendChild(confetti);
                }
            }
            
            // Detect card type based on first digits
            function detectCardType(number) {
                const cardBrands = document.querySelectorAll('.card-brand');
                
                // Reset active state
                cardBrands.forEach(brand => brand.classList.remove('active'));
                
                // Visa: Starts with 4
                if (/^4/.test(number)) {
                    cardType.innerHTML = '<i class="fab fa-cc-visa"></i>';
                    cardBrandLogo.innerHTML = '<i class="fab fa-cc-visa" style="font-size: 30px;"></i>';
                    document.querySelector('.fa-cc-visa').classList.add('active');
                }
                // Mastercard: Starts with 51-55 or 2221-2720
                else if (/^(5[1-5]|222[1-9]|22[3-9]|2[3-6]|27[01])/.test(number)) {
                    cardType.innerHTML = '<i class="fab fa-cc-mastercard"></i>';
                    cardBrandLogo.innerHTML = '<i class="fab fa-cc-mastercard" style="font-size: 30px;"></i>';
                    document.querySelector('.fa-cc-mastercard').classList.add('active');
                }
                // Amex: Starts with 34 or 37
                else if (/^3[47]/.test(number)) {
                    cardType.innerHTML = '<i class="fab fa-cc-amex"></i>';
                    cardBrandLogo.innerHTML = '<i class="fab fa-cc-amex" style="font-size: 30px;"></i>';
                    document.querySelector('.fa-cc-amex').classList.add('active');
                }
                // Discover: Starts with 6011, 622126-622925, 644-649, 65
                else if (/^(6011|65|64[4-9]|622(12[6-9]|1[3-9]|[2-8]|9[01]|92[0-5]))/.test(number)) {
                    cardType.innerHTML = '<i class="fab fa-cc-discover"></i>';
                    cardBrandLogo.innerHTML = '<i class="fab fa-cc-discover" style="font-size: 30px;"></i>';
                    document.querySelector('.fa-cc-discover').classList.add('active');
                }
                // Default
                else {
                    cardType.innerHTML = '<i class="fas fa-credit-card"></i>';
                    cardBrandLogo.innerHTML = '<i class="fas fa-credit-card" style="font-size: 30px;"></i>';
                }
            }
            
            // Allow clicking on card brands to select card type
            document.querySelectorAll('.card-brand').forEach(brand => {
                brand.addEventListener('click', function() {
                    const cardBrands = document.querySelectorAll('.card-brand');
                    cardBrands.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Set a sample card number based on the selected brand
                    if (this.classList.contains('fa-cc-visa')) {
                        cardNumberInput.value = '4111 1111 1111 1111';
                        cardNumberDisplay.textContent = '4111 1111 1111 1111';
                        cardBrandLogo.innerHTML = '<i class="fab fa-cc-visa" style="font-size: 30px;"></i>';
                    } else if (this.classList.contains('fa-cc-mastercard')) {
                        cardNumberInput.value = '5555 5555 5555 4444';
                        cardNumberDisplay.textContent = '5555 5555 5555 4444';
                        cardBrandLogo.innerHTML = '<i class="fab fa-cc-mastercard" style="font-size: 30px;"></i>';
                    } else if (this.classList.contains('fa-cc-amex')) {
                        cardNumberInput.value = '3782 822463 10005';
                        cardNumberDisplay.textContent = '3782 822463 10005';
                        cardBrandLogo.innerHTML = '<i class="fab fa-cc-amex" style="font-size: 30px;"></i>';
                    } else if (this.classList.contains('fa-cc-discover')) {
                        cardNumberInput.value = '6011 1111 1111 1117';
                        cardNumberDisplay.textContent = '6011 1111 1111 1117';
                        cardBrandLogo.innerHTML = '<i class="fab fa-cc-discover" style="font-size: 30px;"></i>';
                    }
                });
            });
            
            // Validate form before submission
            function validateForm() {
                const cardName = cardNameInput.value;
                const cardNumber = cardNumberInput.value.replace(/\s+/g, '');
                const expiryDate = expiryDateInput.value;
                const cvv = cvvInput.value;
                const amount = amountInput.value;
                
                if (!cardName) {
                    showAlert('Please enter cardholder name');
                    return false;
                }
                
                if (cardNumber.length < 13 || cardNumber.length > 19 || !validateCardNumber(cardNumber)) {
                    showAlert('Please enter a valid card number');
                    return false;
                }
                
                if (!expiryDate || expiryDate.length !== 5) {
                    showAlert('Please enter a valid expiry date (MM/YY)');
                    return false;
                }
                
                const [month, year] = expiryDate.split('/');
                const currentDate = new Date();
                const currentYear = currentDate.getFullYear() % 100;
                const currentMonth = currentDate.getMonth() + 1;
                
                if (parseInt(month) < 1 || parseInt(month) > 12) {
                    showAlert('Please enter a valid month (01-12)');
                    return false;
                }
                
                if ((parseInt(year) < currentYear) || 
                    (parseInt(year) === currentYear && parseInt(month) < currentMonth)) {
                    showAlert('Your card has expired');
                    return false;
                }
                
                if (!cvv || cvv.length < 3) {
                    showAlert('Please enter a valid CVV');
                    return false;
                }
                
                if (!amount || amount <= 0) {
                    showAlert('Please enter a valid amount');
                    return false;
                }
                
                return true;
            }
            
            // Show alert message
            function showAlert(message) {
                // Create custom alert
                const alertBox = document.createElement('div');
                alertBox.style.position = 'fixed';
                alertBox.style.top = '20px';
                alertBox.style.left = '50%';
                alertBox.style.transform = 'translateX(-50%)';
                alertBox.style.padding = '12px 20px';
                alertBox.style.backgroundColor = 'rgba(239, 68, 68, 0.08)';
                alertBox.style.color = 'var(--error-color)';
                alertBox.style.borderRadius = '8px';
                alertBox.style.boxShadow = '0 4px 12px rgba(0,0,0,0.08)';
                alertBox.style.zIndex = '1000';
                alertBox.style.fontWeight = '500';
                alertBox.style.fontSize = '14px';
                alertBox.style.textAlign = 'center';
                alertBox.style.animation = 'slideDown 0.3s ease-out';
                alertBox.style.border = '1px solid rgba(239, 68, 68, 0.2)';
                alertBox.style.display = 'flex';
                alertBox.style.alignItems = 'center';
                alertBox.style.gap = '8px';
                
                // Add animation keyframes
                const style = document.createElement('style');
                style.innerHTML = `
                    @keyframes slideDown {
                        from { transform: translate(-50%, -20px); opacity: 0; }
                        to { transform: translate(-50%, 0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
                
                // Add warning icon
                const icon = document.createElement('i');
                icon.className = 'fas fa-exclamation-circle';
                icon.style.color = 'var(--error-color)';
                
                alertBox.appendChild(icon);
                alertBox.appendChild(document.createTextNode(message));
                document.body.appendChild(alertBox);
                
                // Remove alert after 3 seconds
                setTimeout(() => {
                    alertBox.style.animation = 'slideUp 0.3s ease-out forwards';
                    style.innerHTML += `
                        @keyframes slideUp {
                            from { transform: translate(-50%, 0); opacity: 1; }
                            to { transform: translate(-50%, -20px); opacity: 0; }
                        }
                    `;
                    setTimeout(() => {
                        document.body.removeChild(alertBox);
                    }, 300);
                }, 3000);
            }
            
            // Add button ripple effect
            payBtn.addEventListener('mousedown', function(e) {
                const ripple = document.createElement('span');
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.width = ripple.style.height = `${size}px`;
                ripple.style.left = `${x}px`;
                ripple.style.top = `${y}px`;
                ripple.style.position = 'absolute';
                ripple.style.borderRadius = '50%';
                ripple.style.backgroundColor = 'rgba(255, 255, 255, 0.3)';
                ripple.style.transform = 'scale(0)';
                ripple.style.animation = 'ripple 0.6s linear';
                
                const style = document.createElement('style');
                style.innerHTML = `
                    @keyframes ripple {
                        to { transform: scale(4); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
                
                this.style.overflow = 'hidden';
                this.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                    style.remove();
                }, 600);
            });
            
            // Add click event to flip card manually
            creditCard.addEventListener('click', function() {
                this.classList.toggle('flipped');
            });
            
            // Back button functionality
            backBtn.addEventListener('click', function() {
                // Go back to previous page
                window.history.back();
            });
            
            // Handle Enter key press in the form
            document.getElementById('creditCardForm').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    payBtn.click();
                }
            });
            
            // Validate credit card number using Luhn algorithm
            function validateCardNumber(number) {
                // Remove all non-digit characters
                number = number.replace(/\D/g, '');
                
                // Check if the number contains only digits
                if (!/^\d+$/.test(number)) return false;
                
                // Luhn algorithm
                let sum = 0;
                let shouldDouble = false;
                
                // Loop through values starting from the rightmost digit
                for (let i = number.length - 1; i >= 0; i--) {
                    let digit = parseInt(number.charAt(i));
                    
                    if (shouldDouble) {
                        digit *= 2;
                        if (digit > 9) digit -= 9;
                    }
                    
                    sum += digit;
                    shouldDouble = !shouldDouble;
                }
                
                return (sum % 10) === 0;
            }
        });
    </script>
</body>
</html>